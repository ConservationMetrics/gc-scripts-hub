summary: 'CSV: Upload to Postgres'
description: This script uploads CSV data to a Postgres database.
lock: '!inline f/connectors/csv/csv_to_postgres.script.lock'
concurrency_time_window_s: 0
kind: script
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  order:
    - csv_path
    - db
    - db_table_name
    - id_column
    - delete_csv_file
    - attachment_root
  properties:
    attachment_root:
      type: string
      description: >-
        A path where to find the CSV file.
      default: /persistent-storage/datalake
      originalType: string
    db:
      type: object
      description: A database connection for storing tabular data.
      default: null
      format: resource-postgresql
    db_table_name:
      type: string
      description: The name of the database table where the data will be stored.
      default: null
      originalType: string
      pattern: '^.{1,54}$'
    id_column:
      type: string
      description: >-
        Name of the column to use as primary key. If not specified, 
        auto-generates _id with row numbers.
      default: null
      originalType: string
    delete_csv_file:
      type: boolean
      description: Whether to delete the CSV file after processing.
      default: false
    csv_path:
      type: string
      description: The path to the CSV file to upload, including the filename.
      default: null
      originalType: string
  required:
    - csv_path
    - db
    - db_table_name
