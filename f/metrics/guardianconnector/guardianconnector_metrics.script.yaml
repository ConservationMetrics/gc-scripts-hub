summary: 'Guardian Connector: Generate Metrics'
description: >-
  This script generates metrics for Guardian Connector services based on provided parameters. 
  All parameters are optional - the script will only collect metrics for services where required parameters are provided (except Windmill, as Windmill has access to its own API to collect metrics).
  Services: CoMapeo, warehouse, Explorer, Superset, files, Auth0, and Windmill.
lock: '!inline f/metrics/guardianconnector/guardianconnector_metrics.script.lock'
concurrency_time_window_s: 0
kind: script
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  order:
    - comapeo
    - db
    - attachment_root
    - superset_db
    - auth0_m2m
  properties:
    comapeo:
      type: object
      description: >-
        Optional. A server URL and access token pair to connect to a CoMapeo archive server.
        If not provided, CoMapeo metrics will be skipped.
      default: null
      format: resource-comapeo_server
    db:
      type: object
      description: >-
        Optional. Database connection for all PostgreSQL metrics. This connection will be used for Warehouse, 
        Explorer, and Superset metrics, and writing to a `metrics` table in the `guardianconnector` database.
        If not provided, all database operations will be skipped.
      default: null
      format: resource-postgresql
    attachment_root:
      type: string
      description: >-
        Optional. A path where datalake files are stored. This script will calculate 
        the size of the directory and count all files, and do the same for the `comapeo` directory specifically for CoMapeo metrics.
        If not provided, datalake metrics will be skipped.
      default: /persistent-storage/datalake
      originalType: string
    superset_db:
      type: string
      description: >-
        Database name for Superset metrics. Uses 'db' connection parameters with this database name.
      default: superset_metastore
      originalType: string
    auth0_m2m:
      type: object
      description: >-
        Optional. Auth0 Machine-to-Machine (M2M) application credentials.
        Must contain 'client_id', 'client_secret', and 'domain' for an M2M app 
        authorized for the Auth0 Management API with 'read:users' scope.
        If not provided, Auth0 metrics will be skipped.
      default: null
      format: resource-auth0_m2m
  required: []

