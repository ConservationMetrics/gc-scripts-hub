summary: 'CoMapeo: Generate Metrics'
description: >-
  This script generates metrics from the CoMapeo data, including project count and data directory size.
  Note: The data size measurement looks at the `{attachment_root}/comapeo` directory on the datalake, 
  not the CoMapeo server's Docker volume (as Windmill doesn't have mounted access to Docker volumes). 
  This serves as a proxy metric based on the pulled data stored locally.
lock: '!inline f/metrics/comapeo/comapeo_metrics.script.lock'
concurrency_time_window_s: 0
kind: script
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  order:
    - comapeo
    - attachment_root
  properties:
    comapeo:
      type: object
      description: A server URL and access token pair to connect to a CoMapeo archive server.
      default: null
      format: resource-comapeo_server
    attachment_root:
      type: string
      description: >-
        A path where CoMapeo attachments are stored. This script will calculate 
        the size of the `{attachment_root}/comapeo` directory.
      default: /persistent-storage/datalake
      originalType: string
  required:
    - comapeo